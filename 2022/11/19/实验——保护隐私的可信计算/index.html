<!DOCTYPE html><html lang="zh-Hans" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>实验——保护隐私的可信计算 | Ivy Shaw's Blog</title><meta name="keywords" content="cyberspace security"><meta name="author" content="Ivy"><meta name="copyright" content="Ivy"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="实验三：保护隐私的可信计算一、情景引入n 个学生和 1 个老师通信，每个学生都有 1 个数据要发给老师，老师需要知道这 n 个数据之和，而学生们不想让老师知道每个数据的真实值。 二、问题分析 整个情景可以转换为这个问题：n个客户端需要向服务器各自传输1个数据过去，但服务器只能收到这些数据的某种运算结果用以验证（这里以加法为例），对于单个的数据是未知的。  我们首先可以考虑同态加密算法，它是一种满足">
<meta property="og:type" content="article">
<meta property="og:title" content="实验——保护隐私的可信计算">
<meta property="og:url" content="http://example.com/2022/11/19/%E5%AE%9E%E9%AA%8C%E2%80%94%E2%80%94%E4%BF%9D%E6%8A%A4%E9%9A%90%E7%A7%81%E7%9A%84%E5%8F%AF%E4%BF%A1%E8%AE%A1%E7%AE%97/index.html">
<meta property="og:site_name" content="Ivy Shaw&#39;s Blog">
<meta property="og:description" content="实验三：保护隐私的可信计算一、情景引入n 个学生和 1 个老师通信，每个学生都有 1 个数据要发给老师，老师需要知道这 n 个数据之和，而学生们不想让老师知道每个数据的真实值。 二、问题分析 整个情景可以转换为这个问题：n个客户端需要向服务器各自传输1个数据过去，但服务器只能收到这些数据的某种运算结果用以验证（这里以加法为例），对于单个的数据是未知的。  我们首先可以考虑同态加密算法，它是一种满足">
<meta property="og:locale">
<meta property="og:image" content="http://example.com/img/5s.jpg">
<meta property="article:published_time" content="2022-11-19T11:52:27.000Z">
<meta property="article:modified_time" content="2022-11-27T09:22:39.499Z">
<meta property="article:author" content="Ivy">
<meta property="article:tag" content="cyberspace security">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/5s.jpg"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="http://example.com/2022/11/19/%E5%AE%9E%E9%AA%8C%E2%80%94%E2%80%94%E4%BF%9D%E6%8A%A4%E9%9A%90%E7%A7%81%E7%9A%84%E5%8F%AF%E4%BF%A1%E8%AE%A1%E7%AE%97/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '实验——保护隐私的可信计算',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-27 17:22:39'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/mycss.css"><meta name="generator" content="Hexo 5.4.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/head1.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">32</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">4</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/5s.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Ivy Shaw's Blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">实验——保护隐私的可信计算</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-11-19T11:52:27.000Z" title="Created 2022-11-19 19:52:27">2022-11-19</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-11-27T09:22:39.499Z" title="Updated 2022-11-27 17:22:39">2022-11-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AE%9E%E9%AA%8C/">实验</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="实验——保护隐私的可信计算"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="实验三：保护隐私的可信计算"><a href="#实验三：保护隐私的可信计算" class="headerlink" title="实验三：保护隐私的可信计算"></a>实验三：保护隐私的可信计算</h1><h2 id="一、情景引入"><a href="#一、情景引入" class="headerlink" title="一、情景引入"></a>一、情景引入</h2><p>n 个学生和 1 个老师通信，每个学生都有 1 个数据要发给老师，老师需要知道这 n 个数据之和，而学生们不想让老师知道每个数据的真实值。</p>
<h2 id="二、问题分析"><a href="#二、问题分析" class="headerlink" title="二、问题分析"></a>二、问题分析</h2><ol>
<li><p>整个情景可以转换为这个问题：n个客户端需要向服务器各自传输1个数据过去，但服务器只能收到这些数据的某种运算结果用以验证（这里以加法为例），对于单个的数据是未知的。</p>
</li>
<li><p>我们首先可以考虑同态加密算法，它是一种满足同态运算性质的加密算法，即数据在经过同态加密之后，对密文进行特定的计算，得到的计算结果在进行对应的同态解密后的明文等同于对明文数据直接进行相同的计算，常用的有EIGamal乘法同态加密算法和Paillier加法同态加密算法，在这个问题的情景下是要对加密之后的数据进行加法运算，因此选用Paillier加密算法；其次是安全多方计算，在这样的场景下可以使用其他的加密算法，此时的老师只是作为接收数据的一方，因此安全性分析主要是针对于学生而言。</p>
</li>
<li><p>第一种方案是只使用客户端和服务器两端通信，在公钥密码系统中，各客户端应该是持有公钥，而服务器持有私钥，这时客户端的数据就不能直接传给服务器（在计算脚本被封装好了的情况下，每份密文仍然能被抓包的方式获取到），否则服务器可以直接使用私钥解密每段密文，造成隐私泄露，因此这时可以将客户端的数据进行在链上的传递相加，由链上的最后一个客户端将最后的密文发送给服务器。</p>
</li>
<li><p>第二种方案是参考云计算模式，引入可信的第三方，即每个客户端将各自的数据经加密后发送给可信的第三方，由可信的第三方对这些密文进行求和，但是将结果发送给服务器而不是送回给客户端，其中客户端持有公钥，服务器持有私钥，可信第三方不持有密钥。</p>
</li>
<li><p>第三种方案是所有客户端和服务器协商一个大数，由客户端在他们的通信频道中将这个大数随机分成n份，每个客户端从中取一份，然后将各自的数据和这个随机数求和并加密后发送给服务器，服务器对这些密文进行求和计算，再用私钥进行解密，最后减去最开始协商的那个大数就得到了所有用户数据之和。</p>
</li>
<li><p>第四种方案是参考了平均工资问题解法，在这情境下客户端的通信过程仍用一条链来模拟，此时每个客户端都拥有自己的公私钥对，第一个客户端会生成一个随机数与其数据相加，用下一个客户端的公钥加密后发送给他，下一个客户端用自己的私钥解密后再加进自己的数据，同理用再下一个客户端的公钥加密后发送出去，以此类推，最后一个客户端会将加密后的数据发回给第一个客户端，由第一个客户端用其私钥解密之后再减去随机数，就得到了数据之和，最后再发送给服务器。</p>
</li>
<li><p>对于以上所有的可行方案，我们先通过编写脚本进行模拟通信，再从攻击者的角度建立威胁模型，尝试对这些方案进行攻击。</p>
</li>
</ol>
<h2 id="三、算法实现"><a href="#三、算法实现" class="headerlink" title="三、算法实现"></a>三、算法实现</h2><h3 id="第一种方案"><a href="#第一种方案" class="headerlink" title="第一种方案"></a>第一种方案</h3><p>我们采用python的开源库phe来进行paillier算法的便捷实现，按照默认的密钥长度来生成公私钥对，声明有Student和Teacher两个类</p>
<p>其中Student类所具有的属性有text，pubkey，cipher_in，cipher_out和no，分别表示在方案一情景下的学生明文数据，paillier算法的公钥，收到来自上一个学生发来的密文，向下一个学生发送的密文以及序号，另有方法Enc()进行加密操作，show()进行打印验证操作，passCipher()用作传递密文</p>
<p>Teacher类所具有的属性有pubkey，prikey，cipher_in和plaintext，分别表示在方案一情景下paillier算法的私钥，收到来自最后一个学生发来的密文以及解密所得明文，另有方法getKeyPair()用作生成公私钥对，sendPubKey()用作向学生发送公钥，getCipher()用作读取学生发来的密文，Dec()进行解密操作，show()进行打印验证操作，getRes()用作传递解密结果</p>
<p>其他次要的方法见注释</p>
<h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"><span class="keyword">from</span> phe <span class="keyword">import</span> paillier  <span class="comment"># 开源库</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="comment"># 学生类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,text,public_key,cipher,no</span>):</span></span><br><span class="line">        self.text = text</span><br><span class="line">        self.pubkey = public_key</span><br><span class="line">        self.cipher_in = cipher</span><br><span class="line">        self.cipher_out = <span class="number">0</span></span><br><span class="line">        self.cipher_text = <span class="string">&quot;&quot;</span></span><br><span class="line">        self.no = no</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># 加密过程</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Enc</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 这里的加法运算体现paillier的同态运算性质</span></span><br><span class="line">        self.cipher_out = self.cipher_in + self.pubkey.encrypt(self.text)</span><br><span class="line">        self.cipher_text = self.cipher_out.ciphertext(<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> self.no != <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[+] 学生&#123;&#125;的明文是&#123;&#125;，他/她收到来自第&#123;&#125;个学生的密文为&#123;&#125;，经加密之后发送出去的密文为&#123;&#125;&quot;</span>.<span class="built_in">format</span>(self.no + <span class="number">1</span>,self.text,self.no,self.cipher_in.ciphertext(<span class="literal">False</span>),self.cipher_text))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[+] 学生&#123;&#125;的明文是&#123;&#125;，经加密之后发送出去的密文为&#123;&#125;&quot;</span>.<span class="built_in">format</span>(self.no + <span class="number">1</span>,self.text,self.cipher_text))</span><br><span class="line">            </span><br><span class="line">    <span class="comment"># 向下一个学生/老师传输密文</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">passCipher</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.cipher_out</span><br><span class="line"></span><br><span class="line"><span class="comment"># 老师类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Teacher</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,cipher</span>):</span></span><br><span class="line">        self.pubkey,self.prikey = self.getKeyPair()</span><br><span class="line">        self.cipher_in = cipher</span><br><span class="line">        self.plaintext = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getKeyPair</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 测试paillier参数</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] paillier算法的默认私钥大小为&#123;&#125;&quot;</span>.<span class="built_in">format</span>(paillier.DEFAULT_KEYSIZE))</span><br><span class="line">        <span class="keyword">return</span> paillier.generate_paillier_keypair()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sendPubKey</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.pubkey</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getCipher</span>(<span class="params">self,cipher</span>):</span></span><br><span class="line">        self.cipher_in = cipher</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Dec</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.plaintext = <span class="built_in">str</span>(libnum.n2s(self.prikey.decrypt(self.cipher_in)))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] 老师收到的密文是&#123;&#125;，他/她解密之后得到的明文为&#123;&#125;&quot;</span>.<span class="built_in">format</span>(self.cipher_in.ciphertext(<span class="literal">False</span>),self.plaintext))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getRes</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.plaintext</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将明文字符串转换之后得到的数据随机分成n份</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">randomArrayInit</span>(<span class="params">maxValue, num</span>):</span></span><br><span class="line">    suiji_ser = random.sample(<span class="built_in">range</span>(<span class="number">1</span>,maxValue), k=num-<span class="number">1</span>) </span><br><span class="line">    suiji_ser.append(<span class="number">0</span>)   </span><br><span class="line">    suiji_ser.append(maxValue)</span><br><span class="line">    suiji_ser = <span class="built_in">sorted</span>(suiji_ser)</span><br><span class="line">    per_all_persons = [ suiji_ser[i]-suiji_ser[i-<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(suiji_ser)) ] </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> per_all_persons</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始数据读入</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">numInit</span>():</span></span><br><span class="line">    stu_num = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;[-] 请输入学生个数：&quot;</span>))</span><br><span class="line">    plaintext = <span class="built_in">input</span>(<span class="string">&quot;[-] 请输入想加密的字符串，稍后会被转换为数字，随机分配给学生：&quot;</span>)</span><br><span class="line">    plainnum = libnum.s2n(plaintext)</span><br><span class="line">    <span class="keyword">return</span> stu_num,plainnum</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里用循环赋值来模拟客户端链上的数据传输，最后的返回值即为最终的密文</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encryptProcess</span>(<span class="params">stunum,numlist,public_key</span>):</span></span><br><span class="line">    cipher = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(stunum):</span><br><span class="line">        stu = Student(numlist[i],public_key,cipher,i)</span><br><span class="line">        stu.Enc()</span><br><span class="line">        stu.show()</span><br><span class="line">        cipher = stu.passCipher()</span><br><span class="line">    <span class="keyword">return</span> cipher</span><br><span class="line"></span><br><span class="line"><span class="comment"># 老师收到密文之后的解密流程</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decryptProcess</span>(<span class="params">tea</span>):</span></span><br><span class="line">    tea.Dec()</span><br><span class="line">    tea.show()</span><br><span class="line">    <span class="keyword">return</span> tea.getRes()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证同态运算性质</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">judgeHE</span>(<span class="params">plainnum,dec_result</span>):</span></span><br><span class="line">    <span class="keyword">if</span> plainnum == dec_result:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[OvO] 同态加/解密验证成功&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[T^T] 同态加/解密验证失败&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] 方案一具体实现↓↓↓&quot;</span>)</span><br><span class="line">    <span class="comment"># 初始化数据</span></span><br><span class="line">    stunum , plainnum = numInit()</span><br><span class="line">    numlist = randomArrayInit(plainnum,stunum)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] 随机分配的数组：&#123;&#125;&quot;</span>.<span class="built_in">format</span>(numlist))</span><br><span class="line">    <span class="comment"># 先声明一个老师的对象，让其生成公私钥对</span></span><br><span class="line">    teacher = Teacher(<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># 老师向学生发送公钥，这里也是通过赋值来模拟</span></span><br><span class="line">    public_key = teacher.sendPubKey()</span><br><span class="line">    <span class="comment"># 学生开始对数据进行加密</span></span><br><span class="line">    cipher = encryptProcess(stunum,numlist,public_key)</span><br><span class="line">    <span class="comment"># 老师收到最后一个学生发来的密文</span></span><br><span class="line">    teacher.getCipher(cipher)</span><br><span class="line">    <span class="comment"># 老师对密文进行解密</span></span><br><span class="line">    dec_result = decryptProcess(teacher)</span><br><span class="line">    dec_result = libnum.s2n(dec_result[<span class="number">2</span>:-<span class="number">1</span>])</span><br><span class="line">    judgeHE(plainnum,dec_result)</span><br></pre></td></tr></table></figure>

<h4 id="评估"><a href="#评估" class="headerlink" title="评估"></a>评估</h4><p>在该方案的实现中，老师所知道的信息只有公私钥对，学生发来的最终密文和解密之后的明文，而每个学生知道的只有公钥，上一个学生发来的密文以及自己加密得到的密文，老师由于没有单个学生的密文而无法解密得到其个人信息，同时学生没有私钥，也不能解密来自上一个学生发来的密文进行爆破/统计分析，因此该方案在所有参与者诚实的情况下能解决问题。</p>
<h4 id="实现结果"><a href="#实现结果" class="headerlink" title="实现结果"></a>实现结果</h4><p>我们输入要加密的字符串为paillier，学生按照方案中的流程依次对上一个学生发来的密文进行同态加法运算+加密，最后由老师解密得到的结果与原字符串相同</p>
<p><img src="/%E5%8F%AF%E4%BF%A1%E5%AE%9E%E9%AA%8C/1.png" alt="1"></p>
<h3 id="第二种方案"><a href="#第二种方案" class="headerlink" title="第二种方案"></a>第二种方案</h3><p>第二种方案中，我们声明了三个类，分别是Student学生类，Teacher老师类和Third可信第三方类</p>
<p>其中Student类中的属性只有明文，公钥，序号和密文结果，Enc()，show()，passCipher()这三个方法的用处和方案一中的相同</p>
<p>Teacher类和第一种方案完全相同</p>
<p>Third类中有三个属性，数组array用来存储原始格式的密文，arrayNew用来存储处理之后的密文，res是对所有密文求和之后的结果，arrAppend()方法实现的作用是接收所有客户端发来的密文，追加到array和arrayNew中，calRes()方法是将所有密文进行求和得到res，sendRes()方法是将res发送给服务器（老师）</p>
<h4 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"><span class="keyword">from</span> phe <span class="keyword">import</span> paillier  <span class="comment"># 开源库</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="comment"># 学生类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,text,public_key,no</span>):</span></span><br><span class="line">        self.text = text</span><br><span class="line">        self.pubkey = public_key</span><br><span class="line">        self.cipher_out = <span class="number">0</span></span><br><span class="line">        self.cipher_text = <span class="string">&quot;&quot;</span></span><br><span class="line">        self.no = no</span><br><span class="line">    <span class="comment"># 加密过程</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Enc</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.cipher_out = self.pubkey.encrypt(self.text)</span><br><span class="line">        self.cipher_text = self.cipher_out.ciphertext(<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] 学生&#123;&#125;的明文是&#123;&#125;，经加密之后发送给第三方的密文为&#123;&#125;&quot;</span>.<span class="built_in">format</span>(self.no + <span class="number">1</span>,self.text,self.cipher_text))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 向可信第三方传输密文</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">passCipher</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.cipher_out</span><br><span class="line"></span><br><span class="line"><span class="comment"># 老师类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Teacher</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,cipher</span>):</span></span><br><span class="line">        self.pubkey,self.prikey = self.getKeyPair()</span><br><span class="line">        self.cipher_in = cipher</span><br><span class="line">        self.plaintext = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getKeyPair</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 测试paillier参数</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] paillier算法的默认私钥大小为&#123;&#125;&quot;</span>.<span class="built_in">format</span>(paillier.DEFAULT_KEYSIZE))</span><br><span class="line">        <span class="keyword">return</span> paillier.generate_paillier_keypair()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sendPubKey</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.pubkey</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getCipher</span>(<span class="params">self,cipher</span>):</span></span><br><span class="line">        self.cipher_in = cipher</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Dec</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.plaintext = <span class="built_in">str</span>(libnum.n2s(self.prikey.decrypt(self.cipher_in)))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] 老师收到的密文是&#123;&#125;，\n他/她解密之后得到的明文为&#123;&#125;&quot;</span>.<span class="built_in">format</span>(self.cipher_in.ciphertext(<span class="literal">False</span>),self.plaintext))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getRes</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.plaintext</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可信第三方类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Third</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.array = []</span><br><span class="line">        self.res = <span class="number">0</span></span><br><span class="line">        self.arrayNew = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">arrAppend</span>(<span class="params">self,cipher</span>):</span></span><br><span class="line">        self.array = cipher</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cipher)):</span><br><span class="line">            self.arrayNew.append(cipher[i].ciphertext(<span class="literal">False</span>))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calRes</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">for</span> ele <span class="keyword">in</span> self.array:</span><br><span class="line">            self.res += ele</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sendRes</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] 第三方收到的数组为&#123;&#125;,\n求和之后的结果为&#123;&#125;&quot;</span>.<span class="built_in">format</span>(self.arrayNew,self.res.ciphertext(<span class="literal">False</span>)))</span><br><span class="line">        <span class="keyword">return</span> self.res</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将明文字符串转换之后得到的数据随机分成n份</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">randomArrayInit</span>(<span class="params">maxValue, num</span>):</span></span><br><span class="line">    suiji_ser = random.sample(<span class="built_in">range</span>(<span class="number">1</span>,maxValue), k=num-<span class="number">1</span>)</span><br><span class="line">    suiji_ser.append(<span class="number">0</span>)</span><br><span class="line">    suiji_ser.append(maxValue)</span><br><span class="line">    suiji_ser = <span class="built_in">sorted</span>(suiji_ser)</span><br><span class="line">    per_all_persons = [ suiji_ser[i]-suiji_ser[i-<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(suiji_ser)) ]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> per_all_persons</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始数据读入</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">numInit</span>():</span></span><br><span class="line">    stu_num = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;[-] 请输入学生个数：&quot;</span>))</span><br><span class="line">    plaintext = <span class="built_in">input</span>(<span class="string">&quot;[-] 请输入想加密的字符串，稍后会被转换为数字，随机分配给学生：&quot;</span>)</span><br><span class="line">    plainnum = libnum.s2n(plaintext)</span><br><span class="line">    <span class="keyword">return</span> stu_num,plainnum</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里依次向cipher数组中追加对每个学生所计算出的密文，模拟学生和第三方通信的流程</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encryptProcess</span>(<span class="params">stunum,numlist,public_key</span>):</span></span><br><span class="line">    cipher = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(stunum):</span><br><span class="line">        stu = Student(numlist[i],public_key,i)</span><br><span class="line">        stu.Enc()</span><br><span class="line">        stu.show()</span><br><span class="line">        cipher.append(stu.passCipher())</span><br><span class="line">    <span class="keyword">return</span> cipher</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可信第三方工作流程，获得cipher数组之后求和，最后向服务器发送运算结果</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">thirdProcess</span>(<span class="params">thr,cipher</span>):</span></span><br><span class="line">    thr.arrAppend(cipher)</span><br><span class="line">    thr.calRes()</span><br><span class="line">    <span class="keyword">return</span> thr.sendRes()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 老师收到密文之后的解密流程</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decryptProcess</span>(<span class="params">tea,res</span>):</span></span><br><span class="line">    tea.getCipher(res)</span><br><span class="line">    tea.Dec()</span><br><span class="line">    tea.show()</span><br><span class="line">    <span class="keyword">return</span> tea.getRes()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证同态运算性质</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">judgeHE</span>(<span class="params">plainnum,dec_result</span>):</span></span><br><span class="line">    <span class="keyword">if</span> plainnum == dec_result:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[OvO] 同态加/解密验证成功&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[T^T] 同态加/解密验证失败&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] 方案二具体实现↓↓↓&quot;</span>)</span><br><span class="line">    <span class="comment"># 初始化数据</span></span><br><span class="line">    stunum , plainnum = numInit()</span><br><span class="line">    numlist = randomArrayInit(plainnum,stunum)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] 随机分配的数组：&#123;&#125;&quot;</span>.<span class="built_in">format</span>(numlist))</span><br><span class="line">    <span class="comment"># 先声明一个老师的对象，让其生成公私钥对</span></span><br><span class="line">    teacher = Teacher(<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># 声明一个可信第三方</span></span><br><span class="line">    thr = Third()</span><br><span class="line">    <span class="comment"># 老师向学生发送公钥，这里也是通过赋值来模拟</span></span><br><span class="line">    public_key = teacher.sendPubKey()</span><br><span class="line">    <span class="comment"># 学生开始对数据进行加密，结果存储在cipher数组里面</span></span><br><span class="line">    cipher = encryptProcess(stunum,numlist,public_key)</span><br><span class="line">    <span class="comment"># 可信第三方对学生计算出的密文数组进行求和</span></span><br><span class="line">    res = thirdProcess(thr,cipher)</span><br><span class="line">    <span class="comment"># 老师对第三方发来的密文求和结果进行解密</span></span><br><span class="line">    dec_result = decryptProcess(teacher,res)</span><br><span class="line">    dec_result = libnum.s2n(dec_result[<span class="number">2</span>:-<span class="number">1</span>])</span><br><span class="line">    judgeHE(plainnum,dec_result)</span><br></pre></td></tr></table></figure>

<h4 id="评估-1"><a href="#评估-1" class="headerlink" title="评估"></a>评估</h4><p>在该方案的实现中，每个学生直接把各自对应的明文经过公钥加密后得到的密文发送给了可信的第三方，由可信第三方进行求和计算，再将结果发送给老师，这中间的所有通信过程都是单向的，即学生没有私钥，且无法得知求和后的密文，无法破解；可信第三方既没有公钥也没有私钥，只是对一串数据进行了计算，也无法得知学生隐私；老师知道的只有私钥、公钥和求和后的密文，除了用私钥解密之外没有其他办法，因此该方案在所有参与者诚实的情况下能解决问题。</p>
<h4 id="实现结果-1"><a href="#实现结果-1" class="headerlink" title="实现结果"></a>实现结果</h4><p>我们输入要加密的字符串为bupt，学生按照方案中的流程将明文加密后发送给可信第三方，可信第三方进行同台运算求和计算后将结果发送给老师，由老师解密得到的结果与原字符串相同</p>
<p><img src="/%E5%8F%AF%E4%BF%A1%E5%AE%9E%E9%AA%8C/2.png" alt="2"></p>
<h3 id="第三种方案"><a href="#第三种方案" class="headerlink" title="第三种方案"></a>第三种方案</h3><p>第三种方案中我们声明了两个类，分别是Student和Teacher，大体的内容和前两个方案差不多</p>
<p>Student类中另有一个属性为random_offset，用来存储学生通信频道中为其分配的随机数，Enc()方法中是让明文和该随机数相加再用密钥进行加密</p>
<p>Teacher类中另有一个属性为random_sum，用来存储调用getRandomSum()方法所生成的随机数，calRes()方法是对传入的密文数组进行求和，存储到cipher_sum中</p>
<p>整体流程中涉及到一个学生的通信频道，其实就是将老师隔离之外的一个流程，在这里面学生们将老师生成的随机大数进行分解，每个人从其中选取一个数出来，老师只需要知道一个大数就能得到学生们的个人数据之和。</p>
<h4 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"><span class="keyword">from</span> phe <span class="keyword">import</span> paillier  <span class="comment"># 开源库</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getRandomNBitInteger</span><br><span class="line"></span><br><span class="line"><span class="comment"># 学生类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,text,public_key,random_offset,no</span>):</span></span><br><span class="line">        self.text = text</span><br><span class="line">        self.pubkey = public_key</span><br><span class="line">        self.random_offset = random_offset</span><br><span class="line">        self.cipher_out = <span class="number">0</span></span><br><span class="line">        self.cipher_text = <span class="string">&quot;&quot;</span></span><br><span class="line">        self.no = no</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 加密过程</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Enc</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 学生在加密时需要用明文加上自己的随机数</span></span><br><span class="line">        self.cipher_out = self.pubkey.encrypt(self.text + self.random_offset)</span><br><span class="line">        self.cipher_text = self.cipher_out.ciphertext(<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] 学生&#123;&#125;的明文是&#123;&#125;，分得的随机数为&#123;&#125;，经加密之后发送出去的密文为&#123;&#125;&quot;</span>.<span class="built_in">format</span>(self.no + <span class="number">1</span>,self.text,self.random_offset,self.cipher_text))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 向老师传输密文</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">passCipher</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.cipher_out</span><br><span class="line"></span><br><span class="line"><span class="comment"># 老师类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Teacher</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,cipher</span>):</span></span><br><span class="line">        self.pubkey,self.prikey = self.getKeyPair()</span><br><span class="line">        self.cipher_in = cipher</span><br><span class="line">        self.plaintext = <span class="string">&quot;&quot;</span></span><br><span class="line">        self.random_sum = <span class="number">0</span></span><br><span class="line">        self.cipher_arr = []</span><br><span class="line">        self.cipher_sum = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getKeyPair</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># 测试paillier参数</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] paillier算法的默认私钥大小为&#123;&#125;&quot;</span>.<span class="built_in">format</span>(paillier.DEFAULT_KEYSIZE))</span><br><span class="line">        <span class="keyword">return</span> paillier.generate_paillier_keypair()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 生成一个2**60以内的一个大随机数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getRandomSum</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.random_sum = getRandomNBitInteger(<span class="number">60</span>)</span><br><span class="line">        <span class="keyword">return</span> self.random_sum</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 向学生发送公钥</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sendPubKey</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.pubkey</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 接收密文数组</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getCipher</span>(<span class="params">self,cipher</span>):</span></span><br><span class="line">        self.cipher_in = cipher</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 对密文数组求和</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calRes</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> self.cipher_in:</span><br><span class="line">            self.cipher_sum += i</span><br><span class="line">            self.cipher_arr.append(i.ciphertext(<span class="literal">False</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 先对密文求和结果解密之后，减去大数之和就得到了结果</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Dec</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.plaintext = <span class="built_in">str</span>(libnum.n2s(self.prikey.decrypt(self.cipher_sum) - self.random_sum))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] 老师收到的密文是&#123;&#125;，\n求和之后的结果为&#123;&#125;，\n他/她解密之后得到的明文为&#123;&#125;&quot;</span>.<span class="built_in">format</span>(self.cipher_arr,self.cipher_sum.ciphertext(<span class="literal">False</span>),self.plaintext))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getRes</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.plaintext</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将数据随机分成n份</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">randomArrayInit</span>(<span class="params">maxValue, num</span>):</span></span><br><span class="line">    suiji_ser = random.sample(<span class="built_in">range</span>(<span class="number">1</span>,maxValue), k=num-<span class="number">1</span>)</span><br><span class="line">    suiji_ser.append(<span class="number">0</span>)</span><br><span class="line">    suiji_ser.append(maxValue)</span><br><span class="line">    suiji_ser = <span class="built_in">sorted</span>(suiji_ser)</span><br><span class="line">    per_all_persons = [ suiji_ser[i]-suiji_ser[i-<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(suiji_ser)) ]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> per_all_persons</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始数据读入</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">numInit</span>():</span></span><br><span class="line">    stu_num = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;[-] 请输入学生个数：&quot;</span>))</span><br><span class="line">    plaintext = <span class="built_in">input</span>(<span class="string">&quot;[-] 请输入想加密的字符串，稍后会被转换为数字，随机分配给学生：&quot;</span>)</span><br><span class="line">    plainnum = libnum.s2n(plaintext)</span><br><span class="line">    <span class="keyword">return</span> stu_num,plainnum</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里依次向cipher数组中追加对每个学生所计算出的密文，先存储起来再发给老师</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encryptProcess</span>(<span class="params">stunum,numlist,random_list,public_key</span>):</span></span><br><span class="line">    cipher = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(stunum):</span><br><span class="line">        stu = Student(numlist[i],public_key,random_list[i],i)</span><br><span class="line">        stu.Enc()</span><br><span class="line">        stu.show()</span><br><span class="line">        cipher.append(stu.passCipher())</span><br><span class="line">    <span class="keyword">return</span> cipher</span><br><span class="line"></span><br><span class="line"><span class="comment"># 老师收到密文之后的解密流程</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decryptProcess</span>(<span class="params">tea</span>):</span></span><br><span class="line">    tea.calRes()</span><br><span class="line">    tea.Dec()</span><br><span class="line">    tea.show()</span><br><span class="line">    <span class="keyword">return</span> tea.getRes()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证同态运算性质</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">judgeHE</span>(<span class="params">plainnum,dec_result</span>):</span></span><br><span class="line">    <span class="keyword">if</span> plainnum == dec_result:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[OvO] 同态加/解密验证成功&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[T^T] 同态加/解密验证失败&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] 方案三具体实现↓↓↓&quot;</span>)</span><br><span class="line">    <span class="comment"># 初始化数据</span></span><br><span class="line">    stunum , plainnum = numInit()</span><br><span class="line">    numlist = randomArrayInit(plainnum,stunum)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] 随机分配的数组：&#123;&#125;&quot;</span>.<span class="built_in">format</span>(numlist))</span><br><span class="line">    <span class="comment"># 先声明一个老师的对象，让其生成公私钥对</span></span><br><span class="line">    teacher = Teacher(<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># 老师向学生发送公钥，这里也是通过赋值来模拟</span></span><br><span class="line">    public_key = teacher.sendPubKey()</span><br><span class="line">    <span class="comment"># 老师随机生成一个大数</span></span><br><span class="line">    random_sum = teacher.getRandomSum()</span><br><span class="line">    <span class="comment"># 学生们在通信频道中将这个大数分配，顺序无所谓</span></span><br><span class="line">    random_list = randomArrayInit(random_sum,stunum)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] 随机分配的偏移量：&#123;&#125;&quot;</span>.<span class="built_in">format</span>(random_list))</span><br><span class="line">    <span class="comment"># 学生开始对数据进行加密</span></span><br><span class="line">    cipher = encryptProcess(stunum,numlist,random_list,public_key)</span><br><span class="line">    <span class="comment"># 老师收到学生们发来的密文</span></span><br><span class="line">    teacher.getCipher(cipher)</span><br><span class="line">    <span class="comment"># 老师对密文进行解密并减去大数</span></span><br><span class="line">    dec_result = decryptProcess(teacher)</span><br><span class="line">    dec_result = libnum.s2n(dec_result[<span class="number">2</span>:-<span class="number">1</span>])</span><br><span class="line">    judgeHE(plainnum,dec_result)</span><br></pre></td></tr></table></figure>

<h4 id="评估-2"><a href="#评估-2" class="headerlink" title="评估"></a>评估</h4><p>此方案采用了屏蔽老师的随机数分配方法，这里我将老师生成的随机数大小设置为2**60以内，在保证加密效率的同时防止老师能在短时间内破解出其中一个随机数，其他的流程和前面的方案差不多，在高频的通信流程中比较好用（个人看法），比如明文的使用期限很短，客户端和服务器会多次通信等等，这时就算老师将随机数破解出来了，他得到的明文也是没用的，当然在大部分情况下，破解的时间还是非常长了。</p>
<h4 id="实现结果-2"><a href="#实现结果-2" class="headerlink" title="实现结果"></a>实现结果</h4><p>我们输入要加密的字符串为python，老师先生成大数，学生按照方案中的流程将明文+随机数加密后发送给老师，老师对密文解密后得到的结果再减去大数与原字符串python相同</p>
<p><img src="/%E5%8F%AF%E4%BF%A1%E5%AE%9E%E9%AA%8C/3.png" alt="3"></p>
<h3 id="第四种方案"><a href="#第四种方案" class="headerlink" title="第四种方案"></a>第四种方案</h3><p>第四种方案本质上来说就是学生之间的安全多方计算，老师只是作为一个接收明文的载体，不参与任何的加密解密过程。</p>
<p>在学生中可以分为两类，即链上的第一个学生和其他学生，第一个学生具有生成随机数，同时最早计算出所有人的个人数据之和的权限，因此虽然说还是把他/她归为了Student类中，但其中的getRandom()方法是其私有的；对于每个学生而言，他们都拥有各自的公私钥对，这是针对于和他/她紧挨的两个学生来说的加解密。</p>
<p>该方案中采用的加密算法是rsa，密钥长度选择1024，即当前默认能保证基本安全的长度，第一个学生生成的随机数范围是在二进制60位以内，这个数字和加密6-7位字符串之后的量级大小差不多，比较具有参考价值。</p>
<p>另外，在加解密过程中一直存在着一个隐形的学生之间的“通信频道”，可以理解为学生之间的公钥、密文传输都在这上面，这里依然用循环的方式来进行模拟。</p>
<h4 id="代码-3"><a href="#代码-3" class="headerlink" title="代码"></a>代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> rsa</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getRandomNBitInteger, bytes_to_long, long_to_bytes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 学生类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,text,no</span>):</span></span><br><span class="line">        self.text = text</span><br><span class="line">        self.cipher_out = <span class="number">0</span></span><br><span class="line">        self.cipher_text = <span class="string">&quot;&quot;</span></span><br><span class="line">        self.pubkey, self.prikey = self.getKeyPair()</span><br><span class="line">        self.no = no</span><br><span class="line">        self.random = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 生成公私钥对</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getKeyPair</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> rsa.newkeys(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 第一个学生生成一个大的随机数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getRandom</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> self.no == <span class="number">0</span>:</span><br><span class="line">            self.random = getRandomNBitInteger(<span class="number">60</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 向下一个学生发送公钥</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sendPubKey</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.pubkey</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 用自己的密钥对上一个学生发来的密文进行解密</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dec</span>(<span class="params">self,cipher</span>):</span></span><br><span class="line">        <span class="keyword">return</span> rsa.decrypt(cipher,self.prikey)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 加密过程</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">cal</span>(<span class="params">self,next_pubkey,cipher_in</span>):</span></span><br><span class="line">        <span class="comment"># 第一个学生不存在cipher_in，而rsa库的decrypt方法对0加密会报错，因此要区别开来</span></span><br><span class="line">        <span class="keyword">if</span> self.no == <span class="number">0</span>:</span><br><span class="line">            <span class="comment"># 第一个学生是先将随机数和个人数据相加后，再用下一个学生的公钥进行加密</span></span><br><span class="line">            self.cipher_out = rsa.encrypt(long_to_bytes(self.random + self.text),next_pubkey)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[+] 学生&#123;&#125;的明文是&#123;&#125;，\n生成的随机数为&#123;&#125;，\n发送出去的密文为&#123;&#125;&quot;</span>.<span class="built_in">format</span>(self.no + <span class="number">1</span>, self.text,self.random,bytes_to_long(self.cipher_out)))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 后面的学生是先将上一个学生发来的密文用自己的私钥解密，再加上自己的数据，最后用下一个学生的公钥进行加密</span></span><br><span class="line">            self.cipher_out = rsa.encrypt(long_to_bytes(bytes_to_long(self.dec(cipher_in)) + self.text),next_pubkey)</span><br><span class="line">            self.show(cipher_in,rsa.decrypt(cipher_in, self.prikey))</span><br><span class="line">        <span class="keyword">return</span> self.cipher_out</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">self,cipher_in,plain</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] 学生&#123;&#125;的明文是&#123;&#125;，\n他/她收到的密文是&#123;&#125;，\n解密之后为&#123;&#125;，\n发送出去的密文为&#123;&#125;&quot;</span>.<span class="built_in">format</span>(self.no + <span class="number">1</span>,self.text,bytes_to_long(cipher_in),bytes_to_long(plain),bytes_to_long(self.cipher_out)))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 向下一个学生发送密文</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">passCipher</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.cipher_out</span><br><span class="line"></span><br><span class="line"><span class="comment"># 老师类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Teacher</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,plaintext</span>):</span></span><br><span class="line">        self.plaintext = plaintext</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] 老师收到的明文为&#123;&#125;&quot;</span>.<span class="built_in">format</span>(long_to_bytes(self.plaintext)))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getPlaintext</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.plaintext</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将明文字符串转换之后得到的数据随机分成n份</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">randomArrayInit</span>(<span class="params">maxValue, num</span>):</span></span><br><span class="line">    suiji_ser = random.sample(<span class="built_in">range</span>(<span class="number">1</span>,maxValue), k=num-<span class="number">1</span>)</span><br><span class="line">    suiji_ser.append(<span class="number">0</span>)</span><br><span class="line">    suiji_ser.append(maxValue)</span><br><span class="line">    suiji_ser = <span class="built_in">sorted</span>(suiji_ser)</span><br><span class="line">    per_all_persons = [ suiji_ser[i]-suiji_ser[i-<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(suiji_ser)) ]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> per_all_persons</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始数据读入</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">numInit</span>():</span></span><br><span class="line">    stu_num = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;[-] 请输入学生个数：&quot;</span>))</span><br><span class="line">    plaintext = <span class="built_in">input</span>(<span class="string">&quot;[-] 请输入想加密的字符串，稍后会被转换为数字，随机分配给学生：&quot;</span>)</span><br><span class="line">    plainnum = libnum.s2n(plaintext)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> stu_num,plainnum</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端链上的数据处理流程</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encryptProcess</span>(<span class="params">stunum,numlist</span>):</span></span><br><span class="line">    stu_array = []</span><br><span class="line">    cipher = <span class="string">b&#x27;0&#x27;</span></span><br><span class="line">    <span class="comment"># 首先初始化n个学生对象，每个对象都生成各自的公私钥对，生成随机数（除了第一个学生外都是0），将这n个对象存入stu_array中</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(stunum):</span><br><span class="line">        stu = Student(numlist[i],i)</span><br><span class="line">        stu.getKeyPair()</span><br><span class="line">        stu.getRandom()</span><br><span class="line">        stu_array.append(stu)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 每个学生对来自上一个学生的密文先用自己的私钥解密后，再加上自己的数据，用下一个学生的公钥进行加密（这里用mod运算，即最后一个学生用的公钥是第一个学生的）</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(stunum):</span><br><span class="line">        cipher = stu_array[j].cal(stu_array[(j+<span class="number">1</span>) % stunum].sendPubKey(),cipher)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 第一个学生对最后一个学生发来的密文先进行解密，再减去唯有自己知道的随机数就得到了明文</span></span><br><span class="line">    plaintext = bytes_to_long(stu_array[<span class="number">0</span>].dec(cipher))-stu_array[<span class="number">0</span>].random</span><br><span class="line">    <span class="keyword">return</span> plaintext</span><br><span class="line"></span><br><span class="line"><span class="comment"># 老师收到密文之后的解密流程</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decryptProcess</span>(<span class="params">tea</span>):</span></span><br><span class="line">    tea.Dec()</span><br><span class="line">    tea.show()</span><br><span class="line">    <span class="keyword">return</span> tea.getRes()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证同态运算性质</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">judgeHE</span>(<span class="params">plainnum,dec_result</span>):</span></span><br><span class="line">    <span class="keyword">if</span> plainnum == dec_result:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[OvO] 同态加/解密验证成功&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[T^T] 同态加/解密验证失败&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] 方案四具体实现↓↓↓&quot;</span>)</span><br><span class="line">    <span class="comment"># 初始化数据</span></span><br><span class="line">    stunum , plainnum = numInit()</span><br><span class="line">    numlist = randomArrayInit(plainnum,stunum)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] 随机分配的数组：&#123;&#125;&quot;</span>.<span class="built_in">format</span>(numlist))</span><br><span class="line">    <span class="comment"># 学生开始对数据进行加密</span></span><br><span class="line">    plaintext = encryptProcess(stunum,numlist)</span><br><span class="line">    <span class="comment"># 声明一个老师的对象，接收明文并输出结果</span></span><br><span class="line">    teacher = Teacher(plaintext)</span><br><span class="line">    teacher.show()</span><br><span class="line">    dec_result = teacher.getPlaintext()</span><br><span class="line">    judgeHE(plainnum,dec_result)</span><br></pre></td></tr></table></figure>

<h4 id="评估-3"><a href="#评估-3" class="headerlink" title="评估"></a>评估</h4><p>对于此方案的安全性分析可以排除从老师的角度和rsa算法本身的安全性来考虑，一方面是因为老师不参与计算，另一方面是选用的rsa算法密钥长度为1024，不存在被破解的可能性。我们应该具体看第一个用户是否存在恶意行为，以及在链上进行加解密的过程中是否存在其他用户不诚实的情况，这些都放在之后的威胁模型中来考虑。从算法实现的角度来说，学生们最多能知道的就是除自己以外其他所有人的个人数据之和，在没有全部私钥的情况下依然难以破解，因此该方案能有效解决问题。</p>
<h4 id="实现结果-3"><a href="#实现结果-3" class="headerlink" title="实现结果"></a>实现结果</h4><p><img src="/%E5%8F%AF%E4%BF%A1%E5%AE%9E%E9%AA%8C/4.png" alt="4"></p>
<h2 id="四、安全性分析"><a href="#四、安全性分析" class="headerlink" title="四、安全性分析"></a>四、安全性分析</h2><p>对于这四个方案的安全性分析，可以结合初步评估结果和威胁模型的类型来考虑，其中参与者模型包括：</p>
<p>①诚实参与者：所有参与者完全按照协议的要求来完成各个步骤，同时对自己所有的输入、输出和中间计算结果保密</p>
<p>②半诚实参与者：半诚实参与者完全按照协议的要求来完成各个步骤，但同时可能将自己的输入、输出及中间结果泄露给攻击者，也可以根据自己的输入、输出及中间结果推导其他参与者的信息</p>
<p>③恶意参与者：在协议的执行过程中，恶意参与者完全按照攻击者的意志执行协议的各个步骤，不但将自己的所有输入、输出及中间结果泄露给攻击者，还可以根据攻击者的意图改变输入信息、中间结果信息，甚至终止协议</p>
<p>攻击者模型包括：</p>
<p>①拥有无限计算能力的攻击者：不存在数学难题，针对信息论安全而言</p>
<p>②拥有有限计算能力的攻击者：不可能破解当前的数学难题，针对密码学安全而言</p>
<p>现基于以上两种模型，依次对四个方案进行安全性分析（恶意参与者放在了半诚实参与者中分析）：</p>
<h3 id="第一种方案-1"><a href="#第一种方案-1" class="headerlink" title="第一种方案"></a>第一种方案</h3><h4 id="诚实参与者"><a href="#诚实参与者" class="headerlink" title="诚实参与者"></a>诚实参与者</h4><p>在所有参与者都诚实的情况下，第一种方案能解决问题且对于每个学生而言，所接受到的消息只有来自前n-1个学生的密文，自己手上的已知信息只有整个系统的公钥，且paillier加密算法所使用的密钥长度为3072，目前不存在被破解的可能性，此情况下该方案无安全问题。</p>
<h4 id="半诚实参与者"><a href="#半诚实参与者" class="headerlink" title="半诚实参与者"></a>半诚实参与者</h4><p>当整个系统中存在半诚实参与者时，分情况讨论</p>
<p>①<strong>这个人是老师</strong>：老师本身接收到的只有来自n个学生的个人数据求和之后的密文，这意味着学生们都是诚实参与者，于是该数据不会存在问题，解密之后所得的也本身就是他应得的。</p>
<p>当攻击者是其中一名学生时（系统外部的攻击者监听不到数据传输过程），老师将自己的私钥和明文发送给这个学生（在私密通道上），那么除了第二个学生能解密得到第一个学生的个人数据之外，其他所有位置上得到的明文消息都是多个学生的信息之和，无实际意义；当攻击者是其中多名学生时（他们之间信息共享或者就是同一个人），如4个学生中的第二、第四个学生，第二个学生能解密出第一个学生的明文信息，第四个学生在接收到前三个学生的密文信息的时候，根据第二个学生发来的前两段明文，先对密文进行解密，然后减去这两段明文就得到了第三个学生的明文，公式推导如下：<br>$$<br>第二个学生的攻击：m1 = D(prikey,c1)<br>$$</p>
<p>$$<br>第四个学生的攻击：c1+c2+c3=E(m1)+E(m2)+E(m3)，根据同态加法性质，原式=E(m1+m2+m3)<br>$$</p>
<p>$$<br>故m1+m2+m3=D(prikey,c1+c2+c3)，m3=D(prikey,c1+c2+c3)-m1-m2<br>$$</p>
<p>②<strong>这个人是学生</strong>：除了第一个学生之外，其他的所有参与者根据协议，都能接收到来自上一个学生的消息，这时他手里唯一的信息只有自己的明文和密文，但在多人系统中并没有用，因此第一个学生不可能作为半诚实参与者</p>
<p>当攻击者是老师时，该学生会将自己收到的密文以及明文消息发送给老师，设该学生所处位置为i（0&lt;i&lt;n），则老师手里所拥有的信息是<br>$$<br>c1+c2+…+cn，c1+c2+…+ci，mi,prikey,pubkey<br>$$<br>老师同样可以根据同态加减法来求出一段明文，如该学生处于第二个位置上时有：<br>$$<br>m1=D(prikey,c1)=<br>$$<br>处于第n-1个位置上时有：<br>$$<br>mn=D(prikey,cn)=D(prikey,(c1+c2+…cn)-(c1+c2+…ci))<br>$$<br>此时泄露的分别是第一个学生和最后一个学生的个人信息</p>
<p>当攻击者是某个或多个学生时，作为半诚实参与者的学生会将自己的明文和接收到的密文发送给攻击者，此时因为攻击者没有私钥，因此对于拥有有限计算能力的攻击者而言，不可能完成对密钥长度为3072的paillier算法的破解；对于拥有无限计算能力的攻击者来说，唯一的可能是这多个学生（设为i）至少以1个学生的间距来分布，理由如下：</p>
<p>1.如果有两个连续的学生不是攻击者，那么这一部分破解出来的信息是两个学生的个人数据之和，在没有验证程序的情况下无法得知分离出两个正确的值</p>
<p>2.攻击者在这样的情境下的攻击对象是“落单”的诚实参与者，实质上利用的还是同态运算的性质</p>
<p>以两个攻击者中间夹了一个诚实参与者，设这个诚实参与者的序号为i为例：<br>$$<br>mi=Crack(E(c1+c2+…+ci)-E(c1+c2+…+c(i-2))-m(i-1)<br>$$</p>
<h3 id="第二种方案-1"><a href="#第二种方案-1" class="headerlink" title="第二种方案"></a>第二种方案</h3><h4 id="诚实参与者-1"><a href="#诚实参与者-1" class="headerlink" title="诚实参与者"></a>诚实参与者</h4><p>在所有参与者均诚实的情况下，这时第二个方案实际上是最安全的，因为可信的第三方必须是诚实参与者，且在实际的应用环境中，拥有着最强大的计算能力（类似于云计算中心），如果这个第三方和恶意参与者串通的话，则该方案不可能成立，同时该方案理论上的运行效率是最高的，即从学生开始加密到老师接收到密文并解密，一共只有两层的数据传输，运行速度非常快。</p>
<h4 id="半诚实参与者-1"><a href="#半诚实参与者-1" class="headerlink" title="半诚实参与者"></a>半诚实参与者</h4><p>整个方案可以拆解成由n个学生-&gt;可信第三方-&gt;老师的通信流程组成的拓扑结构，理想情况下是同步进行的（虽然在我们自己写的算法中，每个学生是依次发送消息给可信第三方），对于半诚实的参与者而言，他们在这样的情况下是无法接收到其他任何消息的。</p>
<p>于是考虑有恶意参与者的情况，我们在设计方案的时候由于并没有身份验证这一流程，因此如果可信第三方的逻辑是：</p>
<p>设置一条存储前n条消息的缓冲区，一旦队列满了之后就对这些数据进行计算</p>
<p>①<strong>这个人是学生</strong>：</p>
<p>恶意攻击者就可以利用这个逻辑漏洞进行DDoS攻击，即同时发出多条消息，使得其他学生发出的消息被搁置，此时可信第三方计算出来的就不是这n个学生的个人信息之和经加密的结果，于是老师也无法获得正确的信息。</p>
<p>②<strong>这个人是老师</strong>：</p>
<p>如果要充分利用同态加密的性质，那么对于作为恶意攻击者老师来说，如果没有无限计算的能力，最简单的攻击方式就是化破解为加减法，在老师先行控制了某个学生的计算机但没有足够权限直接获得明文时，他可以控制这台电脑重复向可信第三方发送n次消息，老师再根据自己收到的消息进行解密，除以n之后就得到了该学生的信息</p>
<p>如果需要对该方案进行改进，增加这一条协议是非常可行的：</p>
<p>一个学生在一次n的队列周期中只能可信第三方发送一个数据包，发出的多余数据包会被拒收，这可以通过附加数字签名来实现，即每个学生都和第三方之间有一对公私钥，学生用私钥签名，第三方用公钥验签</p>
<p>由于私钥无法伪造且第三方完全可信，这从根本上就避免了由一个恶意参与者发起的DDoS攻击对其他诚实参与者造成的影响</p>
<p>但这个协议也引发了我对攻击方式的进一步思考，如果还有一句：</p>
<p>可信第三方在收到了学生发来的密文之后需要进行响应，如果学生没收到响应或响应错误就将密文重复发一次</p>
<p>虽然在这个方案中第三方说是可信的，但老师如果能伪造可信第三方向某个学生发送的错误响应，再伪造n-1个学生向可信第三方发送多条相同的密文m，那么利用这个协议的攻击方式就是老师在收到最终的密文之后，先减去(n-1)*m，再用私钥进行解密就得到了这个学生的个人信息。</p>
<h3 id="第三种方案-1"><a href="#第三种方案-1" class="headerlink" title="第三种方案"></a>第三种方案</h3><h4 id="诚实参与者-2"><a href="#诚实参与者-2" class="headerlink" title="诚实参与者"></a>诚实参与者</h4><p>在该方案中，学生和老师统一知道的就是一个随机的大数，而老师并不知道这个大数的分配情况，整个方案所利用的也是同态加法的性质，老师在收到所有学生的密文，求和后用私钥解密，再减去随机大数就得到了所有学生的明文之和，由于随机数分配机制的存在，老师用私钥解密单个学生密文得到的并不是真实明文，因此该方案还是比较安全。</p>
<h4 id="半诚实参与者-2"><a href="#半诚实参与者-2" class="headerlink" title="半诚实参与者"></a>半诚实参与者</h4><p>我在设计该方案的时候，实际上并没有考虑到一些很极端的情况，现在对安全性进行分析的时候，发现正是给到了恶意参与者钻空子的机会。</p>
<p>有以下两点：</p>
<p>①n个学生和老师协商的随机数本质上是调用老师类中的方法来实现的，那么老师会利用这个随机数来做事吗？</p>
<p>②n个学生在私密的通信频道中对随机数进行选取，到底是什么在控制这个选取机制？</p>
<p>还是分情况来讨论：</p>
<p>①<strong>这个人是老师</strong>：</p>
<p>根据第一点就很明显，如果老师将这个随机数设置为0，那么对于学生而言，他们每个人所分得的也都是0，而在该方案中并没有对这个随机数的大小进行严格限制，于是每个学生向老师发送的也就是公钥加密之后的个人信息，老师用私钥解密之和就得到了每个人的个人信息。</p>
<p>②<strong>这个人是学生</strong>：</p>
<p>我们在算法实现中是用数组序号对应的形式来为每个学生分配随机数的，然而这里面要做到真正的随机，实际上还应该由一个随机数种子来控制这个分配流程，因为在频道中的分配对于学生而言都是透明可见的，那么如果恶意参与者是老师的话，学生中的半诚实参与者会将各学生对应的随机数情况透露给老师，这时老师就能通过对每个学生的密文用私钥解密后，再减去各自的随机数得到个人信息。</p>
<p>该方案若要做到真正的安全，就需要将随机数的分配情况做到封闭，即每个人都不应该知道这个大数被随机分成了哪些随机数，哪个人又取到了哪个随机数，总之抽取的过程对于其他人而言不可见，也就避免了半诚实参与者能推算或者向老师透露消息的情况，我改进想法有这些：</p>
<p>1.将这个随机数的分解过程托管到可信第三方，每个学生在取数的时候即取即走，不带走其他任何一片云彩</p>
<p>2.将问题转化为：n个人分一个数，如何在保证每个人手里的数之和等于这个数的同时，任何一个人都不知道其他n-1个人手里分别有的数</p>
<p>这个问题即秘密共享，我们可以采用Shamir门限方案来解决问题，首先这个大数的生成是在学生之间进行的，设这个大数为a0，n个学生各生成2个随机数，其中一个随机数是用来作为加密明文时的混淆量，这个需要保密，另一个随机数是Shamir门限方案多项式的有限域上的一个值，这个不需要保密，学生进行加密之后，将密文和第二个随机数发给老师，老师根据这n个随机数只能恢复出大数的值，且任少一个都不能成功恢复，然后老师对密文进行求和，用私钥解密后得到的是所有学生的明文和+大数，再减去大数即可得到结果。</p>
<p>以上这个方案目前来说是最佳的，一方面，只有在攻击者数目为n-1的情况下才能解出剩下那个学生的个人信息，另一方面，由于学生之前互相都不知道各自用作混销量的随机数到底是多少，因为这个随机数唯一所在的地方就是单个学生的密文中，老师在拥有有限计算能力的前提下无法破解出该学生的个人信息。</p>
<h3 id="第四种方案-1"><a href="#第四种方案-1" class="headerlink" title="第四种方案"></a>第四种方案</h3><h4 id="诚实参与者-3"><a href="#诚实参与者-3" class="headerlink" title="诚实参与者"></a>诚实参与者</h4><p>第四个方案的特性是让老师只作为接收明文的载体，实际上不参与任何计算过程，同时让链上每两个相邻的学生组成了一个RSA公钥密钥体系，由于加密过程中每个学生使用的是下一个学生的公钥，而目前1024密钥长度的RSA加密方案是无法被破解的，同时最后一个学生在解出明文之后会向其他所有学生告知，因此该方案能安全地解决问题，唯一的不足就是使用多个公钥密码体系时的加解密流程所消耗的时间太长了，占用了很多资源。</p>
<h4 id="半诚实参与者-3"><a href="#半诚实参与者-3" class="headerlink" title="半诚实参与者"></a>半诚实参与者</h4><p>我们可以首先排除拥有无限计算能力的攻击者，因为一旦私钥被破解，整个加密体系形同虚设，个人信息自然也能被破解出来。</p>
<p>考虑有限计算能力的攻击者，第一个学生是拥有着最大的权限，如果他在解密出明文之后将其篡改或者不发送出去，那么老师就无法获得正确的信息，因此在这种情况下，我们需要将第一个学生的权限降低，我想的改进方案是让所有学生都有一次机会作为链上的首个学生，各自将自己的随机数保密，最后对比他们求解出来的明文结果，如果攻击者占比没有超过50%，一般情况下选择出现频次最高的那个结果即可。</p>
<p>但这样其实也无法避免局部的攻击，有这样的一个情况：</p>
<p>第一个计算者无法确定密文到底传输到哪个学生那里去了，于是第二个学生可以将自己的密文直接发回给第一个学生，这时第一个学生以为后面的n-1个学生已经完成了整个加密流程，于是将第二个学生的密文进行解密后公布，这时第二个学生就可以直接得出第一个学生的明文值，而其他的学生一无所知。</p>
<p>类似的攻击基本上是基于链上的通信流程漏洞来实现的，我们的改进也着眼于协议方面，比如就针对于刚才的这种攻击，我们需要设计一个响应机制（当然是基于数字签名的），后面的学生收到了链上的密文之后向第一个学生发出响应，第一个学生集齐全部n-1个响应才能公布明文，转发给服务器。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Ivy</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://example.com/2022/11/19/%E5%AE%9E%E9%AA%8C%E2%80%94%E2%80%94%E4%BF%9D%E6%8A%A4%E9%9A%90%E7%A7%81%E7%9A%84%E5%8F%AF%E4%BF%A1%E8%AE%A1%E7%AE%97/">http://example.com/2022/11/19/%E5%AE%9E%E9%AA%8C%E2%80%94%E2%80%94%E4%BF%9D%E6%8A%A4%E9%9A%90%E7%A7%81%E7%9A%84%E5%8F%AF%E4%BF%A1%E8%AE%A1%E7%AE%97/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/img/5s.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> Donate</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/11/27/HNCTF2022-Jail%E7%B3%BB%E5%88%97/"><img class="prev-cover" src="/img/5s.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">HNCTF2022 Jail系列</div></div></a></div><div class="next-post pull-right"><a href="/2022/11/13/Dest0g3-520%E8%BF%8E%E6%96%B0%E8%B5%9B-Writeup-1/"><img class="next-cover" src="/img/5s.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Dest0g3 520迎新赛 Writeup(1)</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/head1.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Ivy</div><div class="author-info__description">BUPT | School of Cyberspace Security</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">32</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">4</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/1vyyyyyy"><i class="fab fa-github"></i><span>我的Github</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/1vyyyyyy" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:ivygetshe11@bupt.edu.cn" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="http://wpa.qq.com/msgrd?v=3&amp;uin=1258294332&amp;site=qq&amp;menu=yes" target="_blank" title="QQ"><i class="fab fa-qq"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">个人学习笔记，欢迎与我交流学习</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E4%B8%89%EF%BC%9A%E4%BF%9D%E6%8A%A4%E9%9A%90%E7%A7%81%E7%9A%84%E5%8F%AF%E4%BF%A1%E8%AE%A1%E7%AE%97"><span class="toc-number">1.</span> <span class="toc-text">实验三：保护隐私的可信计算</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%83%85%E6%99%AF%E5%BC%95%E5%85%A5"><span class="toc-number">1.1.</span> <span class="toc-text">一、情景引入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90"><span class="toc-number">1.2.</span> <span class="toc-text">二、问题分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E7%AE%97%E6%B3%95%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.3.</span> <span class="toc-text">三、算法实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%A7%8D%E6%96%B9%E6%A1%88"><span class="toc-number">1.3.1.</span> <span class="toc-text">第一种方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%84%E4%BC%B0"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">评估</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E7%BB%93%E6%9E%9C"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">实现结果</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D%E6%96%B9%E6%A1%88"><span class="toc-number">1.3.2.</span> <span class="toc-text">第二种方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81-1"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%84%E4%BC%B0-1"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">评估</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E7%BB%93%E6%9E%9C-1"><span class="toc-number">1.3.2.3.</span> <span class="toc-text">实现结果</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E7%A7%8D%E6%96%B9%E6%A1%88"><span class="toc-number">1.3.3.</span> <span class="toc-text">第三种方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81-2"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%84%E4%BC%B0-2"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">评估</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E7%BB%93%E6%9E%9C-2"><span class="toc-number">1.3.3.3.</span> <span class="toc-text">实现结果</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E7%A7%8D%E6%96%B9%E6%A1%88"><span class="toc-number">1.3.4.</span> <span class="toc-text">第四种方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81-3"><span class="toc-number">1.3.4.1.</span> <span class="toc-text">代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%84%E4%BC%B0-3"><span class="toc-number">1.3.4.2.</span> <span class="toc-text">评估</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E7%BB%93%E6%9E%9C-3"><span class="toc-number">1.3.4.3.</span> <span class="toc-text">实现结果</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%AE%89%E5%85%A8%E6%80%A7%E5%88%86%E6%9E%90"><span class="toc-number">1.4.</span> <span class="toc-text">四、安全性分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%A7%8D%E6%96%B9%E6%A1%88-1"><span class="toc-number">1.4.1.</span> <span class="toc-text">第一种方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%9A%E5%AE%9E%E5%8F%82%E4%B8%8E%E8%80%85"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">诚实参与者</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%8A%E8%AF%9A%E5%AE%9E%E5%8F%82%E4%B8%8E%E8%80%85"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">半诚实参与者</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D%E6%96%B9%E6%A1%88-1"><span class="toc-number">1.4.2.</span> <span class="toc-text">第二种方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%9A%E5%AE%9E%E5%8F%82%E4%B8%8E%E8%80%85-1"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">诚实参与者</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%8A%E8%AF%9A%E5%AE%9E%E5%8F%82%E4%B8%8E%E8%80%85-1"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">半诚实参与者</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E7%A7%8D%E6%96%B9%E6%A1%88-1"><span class="toc-number">1.4.3.</span> <span class="toc-text">第三种方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%9A%E5%AE%9E%E5%8F%82%E4%B8%8E%E8%80%85-2"><span class="toc-number">1.4.3.1.</span> <span class="toc-text">诚实参与者</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%8A%E8%AF%9A%E5%AE%9E%E5%8F%82%E4%B8%8E%E8%80%85-2"><span class="toc-number">1.4.3.2.</span> <span class="toc-text">半诚实参与者</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E7%A7%8D%E6%96%B9%E6%A1%88-1"><span class="toc-number">1.4.4.</span> <span class="toc-text">第四种方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%9A%E5%AE%9E%E5%8F%82%E4%B8%8E%E8%80%85-3"><span class="toc-number">1.4.4.1.</span> <span class="toc-text">诚实参与者</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%8A%E8%AF%9A%E5%AE%9E%E5%8F%82%E4%B8%8E%E8%80%85-3"><span class="toc-number">1.4.4.2.</span> <span class="toc-text">半诚实参与者</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/11/24/Pwn-Exercise-5/" title="Pwn Exercise(5)">Pwn Exercise(5)</a><time datetime="2023-11-24T03:36:19.000Z" title="Created 2023-11-24 11:36:19">2023-11-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/10/12/Pwn-Exercise-4/" title="Pwn Exercise(4)">Pwn Exercise(4)</a><time datetime="2023-10-12T08:09:19.000Z" title="Created 2023-10-12 16:09:19">2023-10-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/09/03/Pwn-Exercise-3/" title="Pwn Exercise(3)">Pwn Exercise(3)</a><time datetime="2023-09-03T08:55:13.000Z" title="Created 2023-09-03 16:55:13">2023-09-03</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/09/01/Pwn-Exercise-2/" title="Pwn Exercise(2)">Pwn Exercise(2)</a><time datetime="2023-09-01T05:19:08.000Z" title="Created 2023-09-01 13:19:08">2023-09-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/08/30/Pwn-Exercise-1/" title="Pwn Exercise(1)">Pwn Exercise(1)</a><time datetime="2023-08-30T12:11:41.000Z" title="Created 2023-08-30 20:11:41">2023-08-30</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Ivy</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>